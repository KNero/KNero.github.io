# 부팅과정 - 이론 

OS 가 화려하고 고사양으로 발전을 거듭하고 있지만 부팅으로 시작되는 부분은 512바이트의 작은 코드에서 시작하게 된다.
컴퓨터에 대한 지식이 없던 시절에는 궁금하지 않았지만 프로그래밍을 배우면서 CPU의 동작과 메모리의 사용에 대해서 조금 알게 되었을 때는 프로그램의 메모리는 OS가 관리를 하며 사용할 수 있게 도와주지만 
OS는 과연 어떻게 부팅과정을 통해서 자신이 사용할 자원을 CPU 가 찾아가는지 궁금했었다.
이번에는 그 부분에 대해서 알아가면서 개발을 할 것이다.

Booting 과정에서는 프로세서 초기화(멀티코어 관련 처리 포함), 메모리와 외부 디바이스 검사 및 초기화, 브트 로더를 메모리에 복사하고 OS를 시작하는 과정 등이 포함된다.

#### 우리가 만들 OS(MINT64) 부팅과정

1. 전원 켜짐

2. POST(Power On Self Test)

- 프로세서 초기화
- 메모리 검사와 초기화
- 주변 장치 검사와 초기화

**------------- 여기 까지는 BIOS(Basic Input/Output System) 영역 / 다음은 OS 영역 -------------**

3. 부트 로더 이미지를 메모리로 복사 (0x7C00)

4. 부트로더

- OS 이미지를 1 MB 이하의 메모리로 복사
- 보호 모드로 전화

5. 32비트 커널

- 64비트 커널을 2MB 이상의 메모리로 복사
- IA-32e 모드로 전환

6. 64비트 커널

- 멀티코어 설명 및 초기화
- 멀티태스킹 모듈 초기화
- 메모리 관리 모듈 초기화
- 주변 장치 초기화 (키보드, 마우스, 하드 디스크, 시리얼)
- 그래픽 모드로 전환
- 응용프로그램 실행

우리가 익히 들어왔던 BIOS 는 메인보드의 펌웨어의 일종으로 ROM이나 플래시 메모리로 존재하며 전원이 켜짐과 동시에 프로세서가 가장 먼저 실행하는 코드이다.
부팅 옵션 설정이나 시스템 전반적인 설정 값을 관리하며 16비트 환경부터 디스크 입출력과 비디오 모드 전환 등 여러 가지 기능을 제공해왔다.

**BIOS의 수많은 작업중 우리에게 가장 중요한 것은 부트 로더 이미지를 메모리로 복사하는 단계이다.** 부트 로더는 Bootstrap 코드 라고도 불리며 우리가 BIOS에서 처음으로 제어를 넘겨받는 부분이다.

***부트로더는 플로피 디스크나 하드 디스크 등 저장 매체의 가장 앞부분에 존재하며 BIOS 는 POST 가 완료된 후 여러 장치를 검사하여 앞부분에 부트로더가 있는지 확인한다.
부트 로더가 존재한다면 코드를 `0x7C00` 어드레스에 복사한 후 `프로세서가 0x7C00 어드레스부터 코드를 수행하도록 한다.`***
모든 장치에 부트 로더를 찾을 수 없다면 BIOS `'Operating System Not Found'` 와 같은 메시지를 출력하고 작업을 중단한다.

부트로더는 외부 저장 매체에 있으며, 가장 첫 번째 섹터 MBR(Master Boot Record)에 있는 작은 프로그램으로 섹터는 디스크를 구성하는 데이터의 단위로, 섹터 하나는 512바이트로 구성된다.
**부트로더는 512바이트로 고정되어 있으며 아주 작은 공간이기 때문에 기능에 대한 제약이 크다. 
그래서 대부분의 부트로더는 OS 이미지를 메모리로 복사하고 제어를 넘겨주는 정형화된 작업만 수행하고 
앞으로 만들 OS(이름이 MINT64 이다.)에서도 역시 OS 이미지를 디스크에서 메모리로 복사하는 역할만 수행할 것이다.**

그리고 BIOS에 첫 번째 섹터가 부트 로더라는 것을 알려줘야 하는데 **BIOS 는 읽어들인 512바이트 중에 마지막 2바이트의 값이 `0x55, 0xAA` 인지 검사해 부트 로더인지 확인한다.**

(책에서 MINT64 는 64비트를 지원하는 Multi-core Inteligent 의 약자라고 한다.)

